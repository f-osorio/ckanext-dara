<!-- <?xml version="1.0" encoding="UTF-8"?>-->

{% set extras = h.package_extras() %}
{% set dara = h.dara_extras() %}
{% set pkg = h.dara_pkg() %}
{% set auto = h.dara_auto_fields() %}
{% set author = h.dara_first_author() %}
{% set doi = h.dara_doi() %}

{# {% set debug = h.dara_debug() %} #}

{#XXX from Jinja 2.8 on it would be possible to set the whole xml block as
variable and use it inside the template
(http://jinja.pocoo.org/docs/dev/templates/#block-assignments). That way we
could validate directly with template call by giving the xml block as parameter
to the validation function.  Unfortunately this CKAN version (2.2) requires
only Jinja 2.6. It might be possible to replace that, haven't checked yet #}

{% macro xml() -%}

<resource xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="dara_schema_3.xsd">


  <resourceType>{{ auto['ResourceType'] }}</resourceType>
  
  <titles>
    <title>
      <titleName>{{ pkg.title }}</titleName>
       <language>en</language>
    </title>
  </titles>
  
  <creators>  
      <creator> 
        <person>
          <firstName>{{ author.firstname }}</firstName>
          <lastName>{{ author.lastname }}</lastName>
        </person>
      </creator>
  </creators>

  <dataURLs>
    <dataURL>{{ auto.URL }}</dataURL>
  </dataURLs>

  <doiProposal>{{ doi }}</doiProposal>

  <publicationDate>
      <year>{{ dara.dara_PublicationDate }}</year>
  </publicationDate>

  <availability>
      <availabilityControlled>{{ dara.dara_Availabilitycontrolled }}</availabilityControlled>
  </availability>


</resource>

{%- endmacro  %}

{{ xml() }}

{#
<!-- control -
<auto> {{ auto }} </auto>
<inhalt>{{ extras }}</inhalt>
<pkg> {{ pkg  }} </pkg>
-->
#}

