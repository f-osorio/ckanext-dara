<!-- <?xml version="1.0" encoding="UTF-8"?>-->

{# dara xml for RESOURCES 
=========================
schema and example files: 
http://www.da-ra.de/en/technical-information/doi-registration/

actually generated by macros: #}
{% import 'macros/dara_metadata.xml' as macros %}


{% set pkg = h.dara_pkg() %}
{% set dara_authors = h.dara_authors('res', data) %}

{% set res = h.dara_resource() %}
{% set url = h.dara_resource_url(res.url) %}


{# {% set debug = h.dara_debug() %} #}

<resource xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:noNamespaceSchemaLocation="doi:10.4232/10.mdsxsd.3.1">

<!-- this is a Dataset (file) -->
<resourceType>2</resourceType> 
{{ macros.resourceIdentifier(res.id, res.dara_currentVersion)}} 

{# 1. title #}
{# CKAN does not enforce a title for resources. As long as we do not have validation,
we need to make sure here, that dara gets a title #}
{% set name = res.name or 'Untitled' %}
{{ macros.titles(name, 'en') }}  

{# 2. other titles #}
{#XXX not implemented in resources 
{{ macros.otherTitles('en', pkg.dara_OtherTitle or None, pkg.dara_OtherTitleType or None) }} 
#}

{# TODO 3. collective title  #}
      
{# 4. creators  TODO: 4.2 institution #}
{#XXX for now we take the authors given in the collection here #}
<creators>  
{% for author in dara_authors %}
    {{ macros.creator(author) }}
{% endfor %}
</creators>

{# 8. URL, 9. DOI proposal #}
{% set doi = res.dara_DOI_Proposal %}
{{ macros.doi(url, doi) }}

{# *12.publication date #}
{{ macros.publicationDate(res.dara_PublicationDate or pkg.dara_PublicationDate) }}

{# *28/29 availability controlled/free 
default is '1' (Download)
#}
{{ macros.availability(
    res.dara_Availabilitycontrolled or '1', 
    'en', 
    res.dara_Availabilityfree) 
}}

{# 11. resource language #}
{#XXX not implemented for resources #}
{{ macros.resourceLanguage(res.dara_language or None) }}

{# 13. alternative identifier 
XXX not implemented for resource, and we can't use pkg.identifiers here
{{ macros.alternativeIDs(pkg.dara_AlternativeIdentifier_ID or None, pkg.dara_AlternativeIdentifier_Type or None) }}
#}

{# 17. description #}
{% if res.description %}
{{ macros.description(res.description) }}
{% endif %}

{# XXX controlled not implemented yet; can have multiple entries #}  
{#  18. geographic coverage controlled/free #}
{{ macros.geographicCoverages('en', res.dara_geographicCoverage or None, res.dara_geographicCoverageFree or None) }}

{# 19. sampled universe #}
{#XXX we are using 'None' as fallback since the schema is not correct here.
dara expects content, but schema does not force it #}
{{ macros.universes('en', res.dara_universeSampled or None) }}

{# 20. sampling #}
{#XXX not implemented for resources #}
{{ macros.samplings('en', res.dara_Sampling or None) }} {#XXX lang not implemented #}

{# 31. relation #}
{# rel type '9' indicates 'IsPartOf' and references the collection (in our case) #}
{# we need the container element here because the macro only creates single
relations since collection do need to refer to more than one resource #}
<relations>
{{ macros.relation('DOI', pkg.dara_DOI_Proposal, 9) }}
</relations>


</resource>


